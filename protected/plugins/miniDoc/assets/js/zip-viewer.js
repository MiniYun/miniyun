currentPage=0;totalSize=0;$(document).ready(function(){loadData("");$("#page-previous").click(function(){if(currentPage<=0){return}currentPage--;loadData($("#current-path").val())});$("#page-after").click(function(){if(currentPage>=totalSize-1){return}currentPage++;loadData($("#current-path").val())})});function loadData(a){currentPath=$("#current-path").val();if(currentPath!=a){currentPage=0;setParentNav(a)}if(a==""){a="root"}$("#current-path").val(a);crossDomainAjax(encodeUrl(a),function(f){checkStatus(a,f);f=sort(f,"crc",true);var c="";totalSize=Math.ceil(f.length/8);$("#page-info").html((currentPage+1)+"/"+totalSize);for(var b=currentPage*8;b<f.length&&b<(currentPage+1)*8;b++){var e=f[b];var d=$("#domain").val();var g="<tr>";if(isDir(e)){g+="<td><img src='"+d+"/statics/images/main/type/folder.gif'/></td>";g+="<td class='files-name'><a href='#' onclick=\"loadData('"+e.path+"')\">"+e.name+"</a></td>";g+="<td class='files-size'></td>";g+="<td class='files-date'>"+e.date+"</td>";g+="<td class='files-open'><a href='#' onclick=\"loadData('"+e.path+"')\">打开</a></td>"}else{g+="<td><img src='"+d+"/statics/images/main/type/undefind.gif'/></td>";g+="<td class='files-name'><a href='"+downloadUrl(e.crc,e.name)+"'>"+e.name+"</a></td>";g+="<td class='files-size'>"+formatSize(e.size)+"</td>";g+="<td class='files-date'>"+e.date+"</td>";g+="<td class='files-open'><a href='"+downloadUrl(e.crc,e.name)+"'>下载</a></td>"}c+=g}$("#file-list").html(c)})}function sort(b,c,a){b=b.sort(function(e,d){if(a){return(e[c]>d[c])?1:((e[c]<d[c])?-1:0)}else{return(d[c]>e[c])?1:((d[c]<e[c])?-1:0)}});return b}function isDir(b){var c=b.path;var a=c.substring(c.length-1,c.length);if(a=="/"){return true}return false}function encodeUrl(e){var c=$("#host").val();var d=$("#hash").val();var b=$("#type").val();var a=c+"/zip/meta/"+b+"/"+d+"/";if("XDomainRequest" in window&&window.XDomainRequest!==null){e=encodeURI(e)}a+=replaceAll("/","%2f",e);return a}function checkStatus(d,a){if(d!="root"){return true}if(a.length>0){return true}var c="&action=again";var b=window.location.href;if(b.indexOf(c)<0){b=b+"&action=again";window.location.href=b}return false}function crossDomainAjax(c,a){if("XDomainRequest" in window&&window.XDomainRequest!==null){var b=new XDomainRequest();b.open("get",c);b.onload=function(){var d=$.parseJSON(b.responseText);a(d)};b.onprogress=function(){};b.onerror=function(){};b.send()}else{$.ajax({url:c,dataType:"json",type:"GET",async:false,success:function(d,e){a(d)}})}}function setParentNav(h){var c=[];var g=h.split("/");var f="";if(g.length>1){e={name:"-",path:"root"};c.push(e);for(var d=0;d<g.length-2;d++){f=f+g[d]+"/";var e={name:g[d],path:f};c.push(e)}}var a="";for(var b in c){var e=c[b];a+="<li><a href='#' onclick=\"loadData('"+e.path+"')\">"+e.name+"</a></li>"}$("#parent-nav").html(a)}downloadUrl=function(e,b){var d=$("#host").val();var f=$("#hash").val();var c=$("#type").val();var a=d+"/zip/content/"+c+"/"+f+"/"+b+"/"+e;return a};formatSize=function(a){var b=1024*1024*1024;var c=a/b;if(c>1){return c.toFixed(2)+"GB"}b=1024*1024;c=a/b;if(c>1){return c.toFixed(2)+"MB"}b=1024;c=a/b;if(c>1){return c.toFixed(2)+"KB"}return a+"Byte"};function replaceAll(c,a,b){return b.replace(new RegExp(c,"g"),a)};