MiniDoc={};MiniDoc.Setting={add_float_menu_data:function(b){var a={};a.documentview={text:T.MiniDocModule.documentview,ico:"documentview"};for(k in b.right_file){a[k]=b.right_file[k]}b.right_file=a;return b},add_float_menu_cache:function(a){a.setting.documentview=["documentview"];return a},add_menulist:function(b){var a={};a.documentview={text:T.MiniDocModule.documentview,ico:"documentview"};for(k in b){a[k]=b[k]}return a},float_menu_one_file:function(a,b){suffix=b.attr("ico");allow=["doc","docx","xls","xlsx","ppt","pptx","zip","rar"];for(i=0;i<allow.length;i++){if(suffix==allow[i]){a.documentview=true;break}}return a},setFileLimit:function(b){for(var a in b){if(a=="excelSize"){limitExcelSize=b[a]}else{if(a=="pptSize"){limitPPTSize=b[a]}else{if(a=="wordSize"){limitWordSize=b[a]}else{if(a=="zip_rarSize"){limitZip_RarSize=b[a]}}}}}},do_menuitem_event:function(a,b){if(a!="documentview"){return}MiniDoc.Setting.determineType(b.dataList)},determineType:function(a){var f=a[0];var g=f.attr("ico");if(g=="xlsx"){g="xls"}if(g=="docx"){g="doc"}if(g=="pptx"){g="ppt"}var h=f.attr("file_id");var c=f.attr("file_version_id");var e=f.attr("file_size");var b=0;if(g=="xls"){b=limitExcelSize}if(g=="doc"){b=limitWordSize}if(g=="ppt"){b=limitPPTSize}if(g=="zip"||g=="rar"){b=limitZip_RarSize}if(parseInt(e)>(parseInt(b)*1024*1024)){parent.window.Core.MinMessage.Show({text:T.MiniDocModule.file_size_to_big,type:"war",timeout:parent.window.Core.CONFIG.MsgTimeout});return}var d=PAGE_PATHS.MY+"/index.php/miniDoc/viewer/"+g+"?cid="+h+"&rev="+c;if(g=="zip"||g=="rar"){parent.window.Main.MiniDoc.zip.Show(d)}else{window.open(d)}}};MiniDoc.zip=(function(){var c,a,b;var d=function(){var e=this;var g=$('<div id="w_history"><iframe allowTransparency="true" src="" id="iframe_recover" frameborder="0" rel="frame" style="width:550px; height:430px;margin-left:25px;margin-top:10px;" scrolling="no"></iframe><div class="clear"></div><dl class="btn_area"><dd style="margin-left:465px"><a style="width:80px" href="javascript:void(0);" class="btn_white" btn="cancel"><span class="b1"><span class="b2">'+Mt.t(T.Main.close)+"</span></span></a></dd></dl></div>");Core.DialogBase.call(this,{title:Mt.t(T.Main.Shareto_btn_share),content:g,width:600,height:555});var f=function(){};var h=function(){};this.Initial=function(){var j=g.find("[rel='frame']");j.attr("src",a);g.find("[btn]").bind("click",function(l){switch($(this).attr("btn")){case"cancel":e.Close();break}return false})}};return{Show:function(e){if(!b){b=new d()}a=e;b.Open(function(){});b.GetContent().find("[rel='frame']").focus()},Close:function(){b.Close()},SetAPI:function(e){c=e}}})();JSHooks.addFilter("add_float_menu_data",MiniDoc.Setting.add_float_menu_data);JSHooks.addFilter("add_float_menu_cache",MiniDoc.Setting.add_float_menu_cache);JSHooks.addFilter("add_menulist",MiniDoc.Setting.add_menulist);JSHooks.addFilter("float_menu_one_file",MiniDoc.Setting.float_menu_one_file);JSHooks.addAction("do_menuitem_event",MiniDoc.Setting.do_menuitem_event);$(document).ready(function(){$.ajax({url:PAGE_PATHS.MY+"/index.php/miniDoc/push/limitSize",type:"post",dataType:"json",success:function(a){MiniDoc.Setting.setFileLimit(a)}})});