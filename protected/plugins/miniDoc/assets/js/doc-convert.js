function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:undefined}function successCallback(a){if(a.status&&a.uuid!=null){if(a.progress==100){var b=data.callback+"/success";$.ajax({url:b,type:"POST",dataType:"json",data:{hash:data.hash,miniDocServerId:$("#mini-doc-server-id").val()}}).done(function(e){var d="&action=again";var c=window.location.href;c=c.replace(d,"");window.location.href=c});return}else{if(a.progress>0&&a.progress>$("#progress").attr("aria-valuenow")){$("#progress").attr("aria-valuenow",a.progress);$("#progress").css("width",a.progress+"%")}window.setTimeout(function(){Convert.poll(a.uuid)},0)}}else{Convert.onError()}}var Convert={cursor:null,fetch:function(a,b){a._xsrf=getCookie("_xsrf");if(Convert.cursor){a.cursor=Convert.cursor}crossDomainAjax(b,a)},poll:function(b){var a={_xsrf:getCookie("_xsrf")};if(Convert.cursor){a.cursor=Convert.cursor}var c=$("#sub-url").val();crossDomainAjax(c+b,a)},beforeSend:function(){$("#mask").css("display","block");$("#loading-msg").text(T.MiniDocModule.data_loading)},onSuccess:function(a){successCallback(a)},onError:function(){var a=$("#convert-type").val();if(a=="zip"||a=="rar"){$("#canvas").css("display","none")}$("#loading-msg").text(T.MiniDocModule.converted);$("#loading-msg").addClass("tip");$("#progress").attr("aria-valuenow",0);$("#progress").css("width","0%")},onErrorNoServer:function(){alert(T.MiniDocModule.noValidServer);$("#canvas").css("display","none");$("#loading-msg").text(T.MiniDocModule.noValidServer);$("#loading-msg").addClass("tip");$("#progress").attr("aria-valuenow",0);$("#progress").css("width","0%")}};function crossDomainAjax(c,b){if("XDomainRequest" in window&&window.XDomainRequest!==null){Convert.beforeSend();var a=new XDomainRequest();a.open("post",c);a.onload=function(){Convert.onSuccess($.parseJSON(a.responseText))};a.onprogress=function(){};a.onerror=function(){Convert.onError()};a.send($.param(b))}else{$.ajax({url:c,cache:false,dataType:"json",type:"post",data:$.param(b),beforeSend:Convert.beforeSend,success:Convert.onSuccess,error:Convert.onError})}}$(document).ready(function(){var a=data.callback+"/server";$.ajax({url:a,type:"POST",dataType:"json"}).done(function(f){var b=$(window).height();var d=$(window).width();$("#mask").css("width",d);$("#mask").css("height",b);if(f.success==false){Convert.onErrorNoServer()}else{var c="http://"+f.host+"/api/1/"+data.type+"/"+data.hash;var e="http://"+f.host+"/api/1/sub/";$("#sub-url").val(e);$("#mini-doc-server-id").val(f.id);Convert.fetch(data,c);$(window).resize(function(){var g=$(window).height();var h=$(window).width();$("#mask").css("width",h);$("#mask").css("height",g)})}})});